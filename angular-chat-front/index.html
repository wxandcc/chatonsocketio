<!DOCTYPE html>
<html lang="en"  ng-app="chat">
<head>
    <meta charset="UTF-8">
    <title>gamrule chat</title>
</head>
<body>

    <div class="title">chat with friends</div>

<div ng-controller="chatCtrl as vm">
    <div ng-show="vm.formModel.needLogin">
        <input ng-model="vm.formModel.userid"/>
        <input type="button" value="login" ng-click="vm.login();"/>
    </div>
    <div class="friends" ng-if="vm.friends">
        <div class="friend">friend lists</div>
        <div ng-repeat="friend in vm.friends">
            <div class="friend" ng-class="{current: vm.currentChatUser.chatRoom == friend.chatRoom,newMsg:friend.newMsgArrv}" ng-click="vm.chatWithFriend(friend)">{{friend.username}}</div>
        </div>
    </div>
    <div  ng-if="vm.currentChatUser.id">
        <div class="chat">
            <div>I'm {{vm.formModel.userid}} and I'm chatting with {{vm.currentChatUser.id}}-{{vm.currentChatUser.username}}</div>
            <div class="messageBox">
                <div class="radus" ng-class="{me: msg.from == vm.formModel.userid,other:msg.from != vm.formModel.userid}"
                     ng-repeat="msg in vm.userMesage[vm.currentChatUser.chatRoom] track by $index">{{msg.from}}: {{msg.timestamp|date}}:{{msg.message}}</div>
            </div>
            <div>
                <span ng-if="vm.messagePager[vm.currentChatUser.chatRoom].preview">
                    preview-{{vm.messagePager[vm.currentChatUser.chatRoom].preview}}
                </span>
                <span ng-if="vm.messagePager[vm.currentChatUser.chatRoom].current">
                    current-{{vm.messagePager[vm.currentChatUser.chatRoom].current}}
                </span>
                <span ng-if="vm.messagePager[vm.currentChatUser.chatRoom].hasNext()">
                    next-{{vm.messagePager[vm.currentChatUser.chatRoom].next}}
                </span>
            </div>

            <div class="messageinput">
                <input ng-model="vm.formModel.gotosend" />
                <input type="button" ng-click="vm.send(vm.currentChatUser);" value="send"/>
            </div>
        </div>

    </div>
</div>
</body>


<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="public/angular/angular.js"></script>
<script type="text/javascript" src="public/angular-socket-io/socket.min.js"></script>
<script type="text/javascript" src="public/js/chatModule.js"></script>
<link rel="stylesheet" href="public/style/style.css">

</html>